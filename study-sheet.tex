\documentclass{article}
\title{Vault Study Sheet}    
\usepackage[a4paper, total={8.2in, 11in}]{geometry}

\newcommand{\cli}[1]{\texttt{\$ #1}}
\newcommand{\nd}[2]{\textbf{#1}: #2\\} % new definition
\newcommand{\sd}[2]{\indent\textbf{#1}: #2\\} % sub definition
\newcommand{\imp}[1]{\framebox{\textbf{#1}}\\}
\newcommand{\arr}{$\,\rightarrow\,$} % arrow right 
\newcommand{\arl}{$\,\leftarrow\,$} % arrow left

\begin{document}
\setcounter{section}{-1}
\section{Intro to Vault}
\begin{itemize}
  \item \textbf{Overview}: Vault is a secrets management and data protection platform that securely stores, controls access to, and audits sensitive data.
  \item \textbf{Dev Server}: A local, in-memory Vault instance intended for development and testing, with simplified setup and no durability guarantees. Unsealed, Single Unseal key, single v2 kv engine mounted
  \item \textbf{Seal/Unseal}: Sealing encrypts Vault's data and stops access; unsealing decrypts it using key shares so Vault can operate. Servers start sealed.
  \item \textbf{Why A Seal?}: Vault encrypts data using an encryption key. To protect this, it uses another encryption key (known as root key) and stores that encrypted encryption key alongside the encrypted data.
  \item \textbf{Root Key}: Key that is encrypted with the unseal key. Stored alongside other vault data.
  \item \textbf{Namespace API Lock}: Prevents API operations within a namespace, effectively freezing configuration and access changes. Can be done as a break-glass tool in the event of unexpected behavior. Can disable sub-paths and sub-namespaces.
  \item \textbf{Lease, Renew, and Revoke}: Leases define the lifetime of secrets, renew extends their validity, and revoke invalidates them immediately.
  \item \textbf{Vault Lease}: Metadata containing info such as time, key duration, renewability, etc.
  \item \textbf{Authentication}: The process by which users or machines prove their identity to Vault using auth methods like tokens, OIDC, or cloud IAM.
  \item \textbf{Tokens}: Credentials issued by Vault that carry policies and determine what actions a client can perform.
  \item \textbf{Identity}: A system that maps multiple authentication methods to a single logical entity for consistent policy application.
  \item \textbf{OIDC Provider}: Vault can act as an OpenID Connect provider, issuing identity tokens to external applications.
  \item \textbf{Response Wrapping}: A mechanism that wraps sensitive responses in a single-use token to reduce secret exposure.
  \item \textbf{Policies}: Declarative rules that define which paths and operations a client is authorized to access.
  \item \textbf{Password Policies (Unrelated to above)}: Rules that enforce complexity and composition requirements for generated or stored passwords.
  \item \textbf{Username Templating}: Dynamically generates usernames using templates when creating credentials for external systems.
  \item \textbf{High Availability}: Allows multiple Vault nodes to run concurrently with automatic leader election and failover.
  \item \textbf{Production hardening}: Configuration and operational practices that improve security, reliability, and resilience in production environments.
  \begin{itemize}
    \item Avoid Root tokens
    \item Configure user lockout
    \item Enable audit device logs
    \item Disable shell command history
    \item Keep a frequent upgrade cadence
    \item Synchronize Clocks
    \item Restrict Storage access
    \item Do not use clear text credentials
    \item Use the safest algorithms available
    \item Follow best practices for plugins
    \item Be aware of non-deterministic cfg file merging.
    \item Use corrct Filesystem Permissions
    \item Use standard input for vault secrets
    \item Develop an off-boarding process.
    \item Use short TTL's
  \end{itemize}
  \item \textbf{Storage}: The backend used by Vault to persist encrypted data, such as Consul, integrated storage, or cloud object stores.
  \item \textbf{Cloud access management}: Using Vault to broker and manage access to cloud resources through dynamic credentials instead of Privledged-Access-Management.
  \item \textbf{Integrated Storage}: Vault's built-in Raft-based storage backend that removes the need for an external data store.
  \item \textbf{PGP, GnuPG, and Keybase}: Tools and formats supported by Vault for encrypting unseal keys and sensitive outputs.
  \item \textbf{Recovery Mode}: A restricted operational mode that allows administrative recovery actions when Vault is sealed or unhealthy.
  \item \textbf{Resource Quotas}: Limits that control how many resources (e.g., secrets, requests) can be created or consumed.
  \item \textbf{Billing Start Date}: The date from which Vault usage is measured for licensing and billing purposes. License start date if no explicit date is configured.
  \item \textbf{Client count}: A metric representing the number of unique clients interacting with Vault within a billing period.
  \item \textbf{Clients and Entities}: Clients are distinct Vault consumers, while entities group multiple auth identities under one logical user or service.
  \item \textbf{Client Count Calculation}: If no record exists, add entry. If a record exists but last active prior to current month, add new entry, if record exists and entity was last active within the current month, dont add.
  \item \textbf{PKI certificate counts}: Vault does not deduplicate cert counts, 2 certs w/ same CN and SAN are counted as 2 separate certs. use sys/billing/certificates api endpoint
  \item \textbf{Transform}: A feature for format-preserving encryption, tokenization, and obfuscation of sensitive data.
  \item \textbf{Mount Migration}: The process of moving or renaming secrets engines or auth mounts without data loss.
  \item \textbf{Duration String Format}: A human-readable syntax used to specify time intervals in Vault (ns, us, ms, s, m, h, d) (nanoseconds, microseconds, miliseconds, seconds, minutes, hours, days)
  \item \textbf{User lockout}: A security control that temporarily blocks authentication after repeated failed login attempts. Default 5, cooldown default of 15 minutes lockout duration and lockout counter reset.
  \item \textbf{Events (Enterprise)}: Event notifications are arbitrary, non-secret data that can be exchanged between producers (Vault and plugins) and subscribers (Vault components and external users via the API).
  \item \textbf{Filtering (Enterprise)}: Filter expressions use matching operators and selector values to parse out important or relevant information. In some situations, you can use filter expressions to control how Vault processes results.
  \item \textbf{Adaptive overload protection (Enterprise)}: Adaptive overload protection refers to a set of features in Vault Enterprise that prevent client requests from overwhelming different server resources leading to poor availability.
\end{itemize}

\section{Authentication Methods.}
\textbf{Authentication} the process by which user or machine supplied information is verified against an internal or external system. Vault supports multiple auth methods including GitHub, LDAP, AppRole, and more.
A client must authenticate against an auth method. Upon authentication, a token is generated. The token may have attached policy, which is mapped at authentication time.\\

\cli{vault auth enable userpass -path=my-auth}

\begin{itemize}
  \item \textbf{AppRole}: Machine-to-machine authentication such as applications and CI/CD pipelines (Uses RoleID and SecretID; non-interactive)
  \item \textbf{AWS}: Workloads running on AWS infrastructure (Authenticates via IAM identity or EC2 instance metadata)
  \item \textbf{Azure}: Workloads running in Azure environments (Uses Managed Identities or Service Principals)
  \item \textbf{GCP}: Workloads running on Google Cloud Platform (Uses GCP service accounts and signed JWTs)
  \item \textbf{Kubernetes}: Pods authenticating to Vault from Kubernetes clusters (Uses Kubernetes service account JWTs)
  \item \textbf{JWT / OIDC}: Federated identity and single sign-on (Validates signed JWTs from OIDC-compliant identity providers)
  \item \textbf{LDAP}: Human authentication via enterprise directories (Username/password validated against LDAP)
  \item \textbf{Userpass}: Simple human authentication without external identity systems (Credentials stored and managed in Vault)
  \item \textbf{GitHub}: Developer access based on GitHub organizations or teams (OAuth-based authentication)
  \item \textbf{Okta}: Enterprise single sign-on using Okta (Authenticates via Okta API tokens)
  \item \textbf{RADIUS}: Legacy enterprise authentication systems (Challenge/response-based protocol)
  \item \textbf{TLS Certificates}: Strong identity using mutual TLS (Client certificate verification via PKI - Useful for machines)
  \item \textbf{Token}: Bootstrapping and delegated access to Vault (Direct use of pre-issued Vault tokens)
\end{itemize}
\nd{Identity}{A representation of a successful authentication via any auth method}
\nd{Entity}{A single representation of many different identities}
\nd{Alias}{Various corresponding accounts matched to a single entity}
\nd{Identity Group}{Contains Multiple Entities, Subgroups Exist. Policies are inherited}
\sd{Internal Group}{Default in ident store. Membership assigned manually by operators}
\sd{External Group}{Membership managed semi-automatically. Maps to a group that is outside of the ident store. 1 and only 1 alias mapping to the outside group}
\nd{Authentication Process}{User/Machine Supplies information/creds \arr Vault Verifies creds w/ auth method \arr Vault Generates a token and attaches policies \arr Vault returns token to user/machine}
\begin{itemize}
  \item \textbf{API}:  
  Authenticate by calling the auth method login endpoint (e.g. \cli{/v1/auth/<method>/login}).  
  On success, Vault returns a client token used in the \cli{X-Vault-Token} header for subsequent requests.

  \item \textbf{CLI}:  
  Authenticate using \cli{vault login} or a method-specific command (e.g. \cli{vault login -method=ldap}, \cli{vault login -method=oidc}).  
  The CLI stores the returned token locally for future commands.

  \item \textbf{GUI}:  
  Authenticate via the login page by selecting an enabled auth method (e.g. LDAP, OIDC, GitHub).  
  The browser session stores the Vault token and uses it for UI interactions.
\end{itemize}
\nd{Renew Lease}{Use \cli{vault token renew <token>} w/ lease token associated with identity.}
\imp{Identities also have leases}
\section{Vault Policies}
\imp{Authentication: Who are you? | Authorization: What can you do?}
\imp{deny by default}
\nd{Policies}{path based, provide a declarative way to grant or forbid access to certain paths and operations in Vault}
Policy Workflow:
\begin{itemize}
    \item The security team configures Vault to connect and delegate authentication to an external auth method, such as LDAP.
    \item A policy is authored in HCL to define specific access permissions for various paths within Vault.
    \item The policy is uploaded to Vault, where its name serves as a reference or pointer to the underlying rules.
    \item Data from the auth method, such as LDAP groups, is mapped to specific Vault policies to grant users the appropriate access.
\end{itemize}
Auth Workflow:
\begin{itemize}
    \item The user provides their LDAP username and password to Vault to initiate the authentication process.
    \item Vault connects to the LDAP server to verify the credentials and retrieves the user's associated metadata and groups.
    \item Vault matches the user's LDAP groups to pre-configured policies and generates a unique token with those permissions attached.
    \item Vault returns the final token to the user, allowing them to access secrets according to their assigned policies.
\end{itemize}
Policy Capabilities:
\begin{itemize}
    \item \textbf{create} (POST/PUT): Allows the creation of a resource at the given path that does not yet exist.
    \item \textbf{read} (GET): Allows reading the data or configuration stored at the path.
    \item \textbf{update} (POST/PUT): Allows changing data at an existing path; in most engines, this also allows creating the initial value.
    \item \textbf{patch} (PATCH): Allows partial updates to a resource without overwriting the entire data object.
    \item \textbf{delete} (DELETE): Allows the removal of the resource or secret at the specified path.
    \item \textbf{list} (LIST): Allows viewing the names (keys) of resources within a folder, but not the values themselves.
\end{itemize}
Special Capabilities:
\begin{itemize}
    \item \textbf{deny}: Explicitly forbids access to a path; this ALWAYS takes precedence over any other granted capabilities.
    \item \textbf{sudo}: Allows access to "root-protected" paths (usually under \texttt{sys/}) that require higher privileges than standard users.
    \item \textbf{recover}: Allows for the restoration of data from a snapshot for specific secrets engines.
    \item \textbf{subscribe}: Allows a client to listen to events or changes occurring at the specified path.
\end{itemize}
Special Chars:
\nd{Glob (*)}{\texttt{secret/data/team/*} matches any path that begins with that prefix.} \imp{This is NOT regex - only supported as the last char of the path}
\nd{Plus (+)}{A path like \texttt{auth/+/users} matches \texttt{auth/ldap/users} and \texttt{auth/okta/users}, but it will not match \texttt{auth/ldap/admin/users}.}
\nd{Literal Path}{A path defined as \texttt{secret/data/config} only grants access to that specific key; it provides no access to sub-paths like \texttt{secret/data/config/db}}
\nd{The Root Path:}{An empty path or a single \texttt{/} is generally not valid for secret access; policies must specify the mount point (e.g., \texttt{secret/}) to be effective.}
\nd{Trailing Slashes:}{Vault treats \texttt{secret/data/foo} and \texttt{secret/data/foo/} differently; the latter specifically targets the directory or listable index rather than the data object itself.}
Commands:
\nd{Create or Update a Policy:}{\cli{vault policy write} is used for both creating a new policy and updating an existing one. If the policy name already exists, it is overwritten with the new rules. Usage: \cli{vault policy write [options] NAME PATH}}
\nd{Delete a Policy:}{\cli{vault policy delete} removes a policy from the system by its name. Usage: \cli{vault policy delete [options] NAME}}
\nd{List Policies:}{\cli{vault policy list} provides a list of all policies currently configured in the Vault instance. Usage: \cli{vault policy list}}
\nd{Read a Policy:}{\cli{vault policy read} displays the HCL or JSON contents of a specific policy. Usage: \cli{vault policy read [options] NAME}}
\section{Vault Tokens}
\section{Vault Leases}
\section{Secrets Engines}
\section{Encryption as a Service}
\section{Vault Architecture}
\section{Vault Deployment}
\section{Access Management}


\end{document}
